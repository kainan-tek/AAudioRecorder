# AAudio Recorder Demo

这是一个基于Android AAudio API实现的音频录制应用，采用全新架构设计，支持两种录音模式并提供简洁易用的用户界面。

## 功能特点

1. **全新架构实现** - 采用现代化的架构设计，代码结构清晰易读
2. **录音按钮点击逻辑** - 实现多次点击无效的控制，避免重复操作
3. **停止录音按钮点击逻辑** - 实现多次点击无效的控制，避免重复操作
4. **支持两种录音模式** - 通过`CALLBACK_MODE_ENABLE`宏控制编译，可以在回调模式和阻塞模式之间切换
5. **WAV文件保存功能** - 支持指定路径和自动命名两种方式
6. **Kotlin上层实现** - 使用Kotlin语言开发上层应用逻辑
7. **简洁易读的代码** - 保持代码结构清晰，易于理解和维护

## 项目结构

### C++层实现

- `new_aaudio_recorder.cpp` - 全新的AAudio录音器实现，包含以下核心组件：
  - `AudioBuffer`类 - 音频缓冲区管理，支持线程安全的读写操作
  - `NewAAudioRecorder`类 - AAudio录音器主类，支持回调/非回调两种模式
  - WAV文件头处理 - 完整的WAV文件格式支持
  - JNI接口实现 - 与Java/Kotlin层的交互接口

### Kotlin层实现

- `AudioRecorderManager.kt` - 录音管理器，提供与Native层的交互接口
- `MainActivity.kt` - 应用主界面，实现UI交互逻辑

## 核心技术实现

### 1. 音频录制架构

应用采用分层架构设计，分为以下几层：
- UI层 - 处理用户输入和显示状态
- 管理层 - 管理录音状态和操作
- 底层实现 - 与AAudio API交互，处理音频数据

### 2. 两种录音模式

应用支持两种录音模式，可以通过修改`CALLBACK_MODE_ENABLE`宏来切换：

- **回调模式**（`CALLBACK_MODE_ENABLE = 1`）
  - 使用AAudio的回调机制获取音频数据
  - 适合低延迟场景
  - 实现了音频缓冲区和文件写入线程分离

- **阻塞模式**（`CALLBACK_MODE_ENABLE = 0`）
  - 使用阻塞式API读取音频数据
  - 实现简单直接
  - 适合对延迟要求不高的场景

### 3. 多次点击无效控制

在`AudioRecorderManager`类中实现了录音和停止按钮的多次点击无效控制：
- 录音按钮 - 如果正在录音，再次点击不会执行任何操作
- 停止按钮 - 如果不在录音，再次点击不会执行任何操作

### 4. WAV文件保存功能

应用支持两种文件保存方式：
- **指定路径** - 用户可以传入自定义的文件路径
- **自动命名** - 系统会根据当前时间戳自动生成文件名

WAV文件格式支持包含完整的文件头处理，确保录制的音频文件可以被标准音频播放器识别。

## 使用方法

1. 点击"START"按钮开始录音
2. 点击"STOP"按钮停止录音
3. 录音文件默认保存在设备的Music目录下

## 权限要求

应用需要以下权限：
- `RECORD_AUDIO` - 录音权限
- `READ_EXTERNAL_STORAGE`/`READ_MEDIA_AUDIO` - 读取存储权限（Android 13+）
- `WRITE_EXTERNAL_STORAGE` - 写入存储权限

## 技术栈

- **Android AAudio API** - 高性能音频录制
- **C++** - 底层音频处理
- **Kotlin** - 上层应用逻辑
- **CMake** - 构建系统

## 注意事项

1. 确保您的设备支持AAudio API（Android 8.0+）
2. 在使用应用前请确保已授予所有必要的权限
3. 录音文件会占用设备存储空间，请定期清理不需要的录音文件